<!--商品列表-->
<import src="/components/zanui/quantity/index.wxml" />
<import src="/components/zanui/toast/index.wxml" />
<import src="/components/zanui/loadmore/index.wxml" />

<block wx:if="{{isLoaded}}">

	<!--search start-->
	<view class="search">
		<view class="zan-cell zan-form__item flex">
			<view class="searchImg" hidden="{{!showSearch}}" bindtap="closeSearch">
				<image class="arrow" src="../../../images/arrow_lr.png" alt=""></image>
			</view>
			<input
				class="zan-form__input zan-cell__bd flex-1"
				type="text"
				value="{{searchTxt}}"
				bindinput="searchInput"
				placeholder="请输入商品关键字"
			/>
			<view class="searchImg" bindtap="searchGoods">
				<image src="../../../images/icon_search.png" alt=""></image>
			</view>
		</view>
	</view>
	<!--search end-->

	<view class="container">

		<!--searchList start-->
		<view class="searchList flex" hidden="{{!showSearch}}">
			<scroll-view 
				scroll-y
				style="height:{{mWH.height}}px">
				<view class="gItem">
					<block 
						wx:for="{{searchGoods}}" 
						wx:key="">
						<view class="zan-panel item">
							<view class="zan-card">
								<view class="zan-card__thumb">
									<image class="zan-card__img"
										src="{{item.skuMedia.primary.url}}"
										mode="aspectFit"
									></image>
								</view>
								<view class="zan-card__detail">
									<view class="zan-card__detail-row">
										<view class="zan-card__left-col zan-ellipsis--l2">
											{{item.name}}
										</view>
									</view>
									<view class="zan-card__detail-row zan-c-gray-darker">
										<view class="zan-card__left-col zan-c-red">￥ {{item.minPrice}}</view>
									</view>
									
									<block wx:if="{{item.skus.length>1}}">
									<view class="cSpec">
										<button class="zan-btn zan-btn--danger" id="{{item.id}}" bindtap="openChoseSpec">
											<text>规格</text>
											<view class="zan-badge__count" hidden="{{item.quantity.quantity<=0}}">{{item.quantity.quantity}}</view>
										</button>
										<!-- <view class="spec" id="{{item.id}}" bindtap="openChoseSpec" hidden="{{item.quantity.quantity>0}}"></view>
										<view class="quantity">
											<template 
												is="zan-quantity" 
												data="{{ ...item.quantity, componentId: item.id }}" />
										</view> -->
									</view>
									</block>
									<block wx:else>
									<view class="quantity">
										<template 
											is="zan-quantity" 
											data="{{ ...item.skus[0].quantity, componentId: item.skus[0].id }}" />
									</view>
									</block>
								</view>
							</view>
	
						</view>
					</block>
				</view>
	
				<block wx:if="{{noGoods}}">
					<view class="noGoods">抱歉，没有和<text>{{searchTxt}}</text>有关的商品，<br /> 请重新搜索吧！</view>
				</block>
	
				<!--loadmore start-->
				<template is="zan-loadmore" data="{{loading}}" />
				<template is="zan-loadmore" data="{{nodata}}" />
			<!--loadmore end-->
			</scroll-view>
		</view>
		<!--searchList end-->

		<!--goodsList start-->
		<view class="goodsList flex" hidden="{{showSearch}}">

			<!--category start-->
			<scroll-view 
				class="category fl" 
				scroll-y
				style="height:{{mWH.height}}px">
				<block wx:for="{{category}}" wx:key="">
				<view 
					class="item {{item.id == active.id?'active':''}}" 
					id="{{item.id}}"
					bindtap="choseCate">
					{{item.name}}
				</view>
				</block>
			</scroll-view>
			<!--category end-->

			<!--goods start-->
			<scroll-view 
				class="goods fr flex-1" 
				scroll-y
				bindscrolltolower="getMoreGoods"
				style="height:{{mWH.height}}px">

				<view 
					class="gItem active">
					<view class="gTit">{{active.name}}</view>
					{{goods[index].cid}}
					<block 
						wx:for="{{goods}}" 
						wx:key="">
					<view class="zan-panel item" hidden="{{item.cid !== active.id}}">
						<view class="zan-card">
							<view class="zan-card__thumb">
								<image class="zan-card__img"
								src="{{item.skuMedia.primary.url}}"
								mode="aspectFit"
								></image>
							</view>
							<view class="zan-card__detail">
								<view class="zan-card__detail-row">
									<view class="zan-card__left-col zan-ellipsis--l2">
										{{item.name}}
									</view>
								</view>
								<view class="zan-card__detail-row zan-c-gray-darker">
									<view class="zan-card__left-col zan-c-red">￥ {{item.minPrice}}</view>
								</view>
								
								<block wx:if="{{item.skus.length>1}}">
								<view class="cSpec">
									<button class="zan-btn zan-btn--danger" id="{{item.id}}" bindtap="openChoseSpec">
										<text>规格</text>
										<view class="zan-badge__count" hidden="{{item.quantity.quantity<=0}}">{{item.quantity.quantity}}</view>
									</button>
									<!-- <view class="spec" id="{{item.id}}" bindtap="openChoseSpec" hidden="{{item.quantity.quantity>0}}"></view>
									<view class="quantity">
										<template 
											is="zan-quantity" 
											data="{{ ...item.quantity, componentId: item.id }}" />
									</view> -->
								</view>
								</block>
								<block wx:else>
								<view class="quantity">
									<template 
										is="zan-quantity" 
										data="{{ ...item.skus[0].quantity, componentId: item.skus[0].id }}" />
								</view>
								</block>
							</view>
						</view>

					</view>
					</block>
				</view>

				<!--loadmore start-->
				<template is="zan-loadmore" data="{{loading}}" />
				<template is="zan-loadmore" data="{{nodata}}" />
				<!--loadmore end-->

			</scroll-view>
			<!--goods end-->

		</view>
		<!--goodsList end-->

		<!--setOrder start-->
		<view class="setOrder flex">
			<view class="cartInfo fl flex-1">
				<view 
					bindtap="toggleDialog"
					class="i">
					<image 
						class="img"
						src="../../../images/shoppingCart.png"></image>
					<text class="t">￥ {{totalPrice}}</text>
				</view>
			</view>
			<button class="zan-btn zan-btn--danger" bindtap="orderNow">立即下单</button>
		</view>
		<!--setOrder end-->

		<!--choseSpec start-->
		<view 
			class="choseSpec myPop"
			hidden="{{!popOn}}"
			catchtouchmove="mynotouch">
			<view class="popMain animated {{popOn?'bounceInUp':'bounceOutDown'}}">
				<icon bindtap="closePop" class="close" type="cancel" size="20" color="{{item}}"/>
				<view class="tac tit">{{showSearch===false?goods[activeIndex].name:searchGoods[activeIndex].name}}</view>
				<view class="m">
					<block 
						wx:for="{{showSearch===false?goods[activeIndex].skusTypes:searchGoods[activeIndex].skusTypes}}"
						wx:for-index="idx" 
						wx:key="">
					<view class="item" id="{{idx}}">
						<view class="t">{{item.name}}</view>
						<view class="l">
							<block wx:for="{{item.items}}" wx:key="" wx:for-item="gg">
							<view 
								class="si fl {{item.checked===gg.id?'active':''}}" 
								data-fId="{{idx}}"
								id="{{gg.id}}" 
								bindtap="chosegg">
								<text>{{gg.val}}</text>
							</view>
							</block>
						</view>
					</view>
					</block>
				</view>
				<view class="o flex">
					<view class="t fl flex-1">
						￥<text>{{activeSku.amount || 0}}</text> 
						<text class="gg"></text>
					</view>
					<view class="fr">
						<button 
							class="zan-btn zan-btn--danger" 
							id="{{showSearch===false?goods[activeIndex].id:searchGoods[activeIndex].id}}" 
							bindtap="addShopCartBtn"
							disabled="{{!activeSku.quantity || activeSku.quantity.quantity >= activeSku.quantity.max}}">加入购物车</button>
					</view>
					
				</view>
			</view>
			<view class="popMask"></view>
		</view>
		<!--choseSpec end-->

		<!--shopCart start-->
		<view class="shopCart zan-dialog {{ showDialog ? 'zan-dialog--show' : '' }}">
			<view class="zan-dialog__mask" bindtap="toggleDialog" />
			<view class="zan-dialog__container">
				<view class="clearShop tar" bindtap="clearShopCart">
					<image src="../../../images/delete.png"></image>
					清空购物车
				</view>
				<scroll-view 
					class="shopList" 
					scroll-y>
					<block wx:for="{{shopcart}}" wx:key="">
					<view class="item flex">
						<view class="t fl">{{item.skus.longName}}</view>
						<view class="m fl">￥{{item.skus.amount}}</view>
						<view class="quantity fl flex-1">
							<template 
								is="zan-quantity" 
								data="{{ ...item.skus.quantity, componentId: item.skus.id }}" />
						</view>
					</view>
					</block>

				</scroll-view>
			</view>
		</view>
		<!--shopCart end-->

	</view>
	<template is="zan-toast" data="{{ zanToast }}"></template>
</block>




